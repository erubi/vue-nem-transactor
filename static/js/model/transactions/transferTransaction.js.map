{"version":3,"sources":["../../../src/model/transactions/transferTransaction.js"],"names":["prepare","common","tx","network","Error","kp","create","fixPrivateKey","privateKey","actualSender","isMultisig","multisigAccount","publicKey","toString","recipientCompressedKey","recipient","amount","Math","round","message","due","data","testnet","id","mosaics","mosaicsFee","entity","_construct","prepareMosaic","mosaicDefinitionMetaDataPair","calculateMosaics","senderPublicKey","timeStamp","createNEMTimeStamp","version","getVersion","transfer","msgFee","payload","length","calculateMessage","fee","currentFeeFactor","calculateMinimum","totalFee","custom","toUpperCase","replace","extendObj","module","exports"],"mappings":"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","file":"transferTransaction.js","sourcesContent":["import Network from '../network';\nimport Helpers from '../../utils/helpers';\nimport TransactionTypes from '../transactionTypes';\nimport Fees from '../fees';\nimport KeyPair from '../../crypto/keyPair';\nimport Objects from '../objects';\nimport MultisigWrapper from './multisigWrapper';\nimport Message from './message';\n\n/**\n * Prepare a transfer transaction object\n *\n * @param {object} common - A common object\n * @param {object} tx - The un-prepared transfer transaction object\n * @param {number} network - A network id\n *\n * @return {object} - A [TransferTransaction]{@link http://bob.nem.ninja/docs/#transferTransaction} object ready for serialization\n */\nlet prepare = function(common, tx, network){\n    if (!common || !tx || !network) throw new Error('Missing parameter !');\n\tlet kp = KeyPair.create(Helpers.fixPrivateKey(common.privateKey));\n    let actualSender = tx.isMultisig ? tx.multisigAccount.publicKey : kp.publicKey.toString();\n    let recipientCompressedKey = tx.recipient.toString();\n    let amount = Math.round(tx.amount * 1000000);\n    let message = Message.prepare(common, tx);\n    let due = network === Network.data.testnet.id ? 60 : 24 * 60;\n    let mosaics = null;\n    let mosaicsFee = null\n    let entity = _construct(actualSender, recipientCompressedKey, amount, message, due, mosaics, mosaicsFee, network);\n    if (tx.isMultisig) {\n        entity = MultisigWrapper(kp.publicKey.toString(), entity, due, network);\n    }\n    return entity;\n}\n\n\n/**\n * Prepare a mosaic transfer transaction object\n *\n * @param {object} common - A common object\n * @param {object} tx - The un-prepared transfer transaction object\n * @param {object} mosaicDefinitionMetaDataPair - The mosaicDefinitionMetaDataPair object with properties of mosaics to send\n * @param {number} network - A network id\n *\n * @return {object} - A [TransferTransaction]{@link http://bob.nem.ninja/docs/#transferTransaction} object ready for serialization\n */\nlet prepareMosaic = function(common, tx, mosaicDefinitionMetaDataPair, network){\n    if (!common || !tx || !mosaicDefinitionMetaDataPair || tx.mosaics === null || !network) throw new Error('Missing parameter !');\n    let kp = KeyPair.create(Helpers.fixPrivateKey(common.privateKey));\n    let actualSender = tx.isMultisig ? tx.multisigAccount.publicKey : kp.publicKey.toString();\n    let recipientCompressedKey = tx.recipient.toString();\n    let amount = Math.round(tx.amount * 1000000);\n    let message = Message.prepare(common, tx);\n    let due = network === Network.data.testnet.id ? 60 : 24 * 60;\n    let mosaics = tx.mosaics;\n    let mosaicsFee = Fees.calculateMosaics(amount, mosaicDefinitionMetaDataPair, mosaics);\n    let entity = _construct(actualSender, recipientCompressedKey, amount, message, due, mosaics, mosaicsFee, network);\n    if (tx.isMultisig) {\n        entity = MultisigWrapper(kp.publicKey.toString(), entity, due, network);\n    }\n    return entity;\n}\n\n/***\n * Create a transfer transaction object\n *\n * @param {string} senderPublicKey - The sender account public key\n * @param {string} recipientCompressedKey - The recipient account public key\n * @param {number} amount - The amount to send in micro XEM\n * @param {object} message - The message object\n * @param {number} due - The deadline in minutes\n * @param {array} mosaics - The array of mosaics to send\n * @param {number} mosaicFee - The fees for mosaics included in the transaction\n * @param {number} network - A network id\n *\n * @return {object} - A [TransferTransaction]{@link http://bob.nem.ninja/docs/#transferTransaction} object\n */\nlet _construct = function(senderPublicKey, recipientCompressedKey, amount, message, due, mosaics, mosaicsFee, network) {\n    let timeStamp = Helpers.createNEMTimeStamp();\n    let version = mosaics ? Network.getVersion(2, network) : Network.getVersion(1, network);\n    let data = Objects.create(\"commonTransactionPart\")(TransactionTypes.transfer, senderPublicKey, timeStamp, due, version);\n    let msgFee = message.payload.length ? Fees.calculateMessage(message) : 0;\n    let fee = mosaics ? mosaicsFee : Fees.currentFeeFactor * Fees.calculateMinimum(amount / 1000000);\n    let totalFee = (msgFee + fee) * 1000000;\n    let custom = {\n        'recipient': recipientCompressedKey.toUpperCase().replace(/-/g, ''),\n        'amount': amount,\n        'fee': totalFee,\n        'message': message,\n        'mosaics': mosaics\n    };\n    let entity = Helpers.extendObj(data, custom);\n    return entity;\n}\n\nmodule.exports = {\n    prepare,\n    prepareMosaic\n}"]}